import{r as d,j as e,b as g,y as o}from"./index-Bqo-M_EE.js";import{A as n}from"./api-rbqg8V8q.js";import"./index-NIGUFBhG.js";function A({userId:x,isQRView:a=!1}){const[i,m]=d.useState({prescriptions:[],tests:[]}),[t,h]=d.useState(null),[p,c]=d.useState(!1),j=async()=>{try{let s;a&&x?s=await n.get(`/user/public/${x}`):s=await n.get("/user/me"),m({prescriptions:s.data.prescriptions||[],tests:s.data.tests||[]}),h(s.data.user||s.data)}catch(s){console.error(s)}};d.useEffect(()=>{j()},[a,x]);const u=s=>{if(!s)return"";const[l,r,f]=s.split("-");return`${f}/${r}/${l}`},N=async s=>{if(!a){c(!0);try{await n.delete(`/upload/prescription/${s}`),o.success("Prescription deleted"),m(l=>({...l,prescriptions:l.prescriptions.filter(r=>r._id!==s)}))}catch{o.error("Failed to delete prescription.")}finally{c(!1)}}},b=async s=>{if(!a){c(!0);try{await n.delete(`/upload/test/${s}`),o.success("Test result deleted"),m(l=>({...l,tests:l.tests.filter(r=>r._id!==s)}))}catch{o.error("Failed to delete test result.")}finally{c(!1)}}};return e.jsxs("div",{className:"p-6 bg-gradient-to-br from-yellow-50 via-white to-blue-50 min-h-screen flex flex-col items-center",children:[p&&e.jsx(g,{text:"Deleting..."}),e.jsx("h2",{className:"text-3xl font-bold text-slate-800 mb-6",children:a?"Public Medical History":"Medical History"}),t&&e.jsxs("div",{className:"bg-white shadow rounded-xl p-6 mb-8 border border-yellow-100 w-full max-w-4xl",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:t.avatar||"https://via.placeholder.com/100",alt:"User Avatar",className:"w-28 h-28 rounded-full border-4 border-blue-100 shadow-md"})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-x-12 gap-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Name"}),e.jsx("p",{className:"font-semibold",children:t.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Date of Birth"}),e.jsx("p",{className:"font-semibold",children:u(t.dob)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Blood Group"}),e.jsx("p",{className:"font-semibold",children:t.bloodGroup||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Phone"}),e.jsx("p",{className:"font-semibold",children:t.phone||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Emergency Contact"}),e.jsx("p",{className:"font-semibold",children:t.emergencyContact||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Height"}),e.jsx("p",{className:"font-semibold",children:t.height||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Weight"}),e.jsx("p",{className:"font-semibold",children:t.weight||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Chronic Diseases"}),e.jsx("p",{className:"font-semibold",children:t.chronicDiseases||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Allergies"}),e.jsx("p",{className:"font-semibold",children:t.allergies||"N/A"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Medicines"}),e.jsx("p",{className:"font-semibold",children:t.medicines||"N/A"})]})]})]}),e.jsxs("div",{className:"w-full max-w-4xl",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-3",children:"Prescriptions"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:i.prescriptions.length>0?i.prescriptions.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow hover:shadow-md transition relative border border-blue-100",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.imageUrl,alt:"Prescription",className:"w-40 h-40 object-contain cursor-pointer",onClick:()=>window.open(s.imageUrl,"_blank")})}),e.jsx("div",{className:"text-xs text-slate-500 mt-2 text-center",children:s.prescriptionDate?new Date(s.prescriptionDate).toLocaleDateString():"N/A"}),!a&&e.jsx("button",{onClick:()=>N(s._id),className:"absolute top-2 right-2 px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600 shadow",children:"Delete"})]},s._id)):e.jsx("p",{className:"text-slate-500",children:"No prescriptions uploaded yet."})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mt-8 mb-3",children:"Test Results"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:i.tests.length>0?i.tests.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow hover:shadow-md transition relative border border-blue-100",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.url,alt:"Test Result",className:"w-40 h-40 object-contain cursor-pointer",onClick:()=>window.open(s.url,"_blank")})}),e.jsx("div",{className:"text-xs text-slate-500 mt-2 text-center",children:s.uploadedAt?new Date(s.uploadedAt).toLocaleDateString():"N/A"}),!a&&e.jsx("button",{onClick:()=>b(s._id),className:"absolute top-2 right-2 px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600 shadow",children:"Delete"})]},s._id)):e.jsx("p",{className:"text-slate-500",children:"No test results uploaded yet."})})]})]})}export{A as default};
